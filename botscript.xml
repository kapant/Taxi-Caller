<context>
	<pattern name = "From" value = "$Text"/>
	<pattern name = "To" value = "$Text"/>
	<input pattern = "* (такси) * { [(от|с) [$From] [пожалуйста|буд*]] * [(до|к) [$To] [пожалуйста|буд*]] }">
  		<context if = "empty($From)" modal = "true">
			<output value = "Откуда едем?"/>
			<input pattern = "$From">
				<context id = "empty_to" if = "empty($To)"/>
				<context id = "done"/>
			</input>
		</context>
		<context if = "empty($To)" modal = "true" id = "empty_to">
			<output value = "Куда едем?"/>
			<input pattern = "$To">
				<context id = "done"/>
			</input>
		</context>
		<context id = "done">
			<get url = "https://geocode-maps.yandex.ru/1.x/" var = "Place">
				<param name = "format" value = "json"/>
				<param name = "geocode" value = "$From"/>
			</get>
			<var name = "GeoFrom">
				<script>
					$Place.response.GeoObjectCollection.featureMember[0].GeoObject.metaDataProperty.GeocoderMetaData.text;
				</script>
			</var>
			<get url = "https://geocode-maps.yandex.ru/1.x/" var = "Place">
				<param name = "format" value = "json"/>
				<param name = "geocode" value = "$To"/>
			</get>
			<var name = "GeoTo">
				<script>
					$Place.response.GeoObjectCollection.featureMember[0].GeoObject.metaDataProperty.GeocoderMetaData.text;
				</script>
			</var>
			<output value = "Нужно такси от $GeoFrom до $GeoTo, верно?"/>
			<input pattern = "* [да|верно|ага|так] *">
				<output value = "Обработка"/>
			</input>
			<input pattern = "* (не*) *">
				<script>
					$From = "";
					$To = "";
				</script>
				<context id = "empty_from"/>
			</input>
		</context>
	</input>
</context>
